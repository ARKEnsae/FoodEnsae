<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<style>body{background-color:white;}</style>
<script src="r2d3_libs/htmlwidgets/htmlwidgets.js"></script>
<script src="r2d3_libs/r2d3-render/r2d3-render.js"></script>
<script src="r2d3_libs/webcomponents/webcomponents.js"></script>
<script src="r2d3_libs/r2d3-binding/r2d3.js"></script>
<script src="r2d3_libs/pymjs/pym.v1.min.js"></script>
<script src="r2d3_libs/d3v6/d3.min.js"></script>
  <title>r2d3</title>
</head>
<body>
<div id="htmlwidget_container">
  <div id="htmlwidget-8cb82c2c3145491238d2" style="width:100%;height:340px;" class="r2d3 html-widget"></div>
  <script>HTMLWidgets.pymChild = new pym.Child();HTMLWidgets.addPostRenderHandler(function(){
                                setTimeout(function(){HTMLWidgets.pymChild.sendHeight();},100);
                            });</script>
</div>
<script type="application/json" data-for="htmlwidget-8cb82c2c3145491238d2">{"x":{"data":{"Country":["A","B","C","D","E"],"Value":[101970,81563,133343,195453,118334],"pourc":[16.2,12.9,21.1,31,18.8],"color":["#387E48","#91B849","#F7CB46","#E08531","#D54C29"]},"type":"data.frame","container":"cont","options":{"borne_max":400000,"titre":"Nombre de produits selon le nutri-score","note1":"Note : Sur les 1 635 635 produits de la base de données, seuls figurent","note2":"ici les 630 663 pour lesquels un nutri-score est indiqué."},"script":"var d3Script = function(d3, r2d3, data, cont, width, height, options, theme, console) {\nthis.d3 = d3;\n\ncont = d3.select(cont.node());\n/* R2D3 Source File:  data/lollichart.js */\n//var width = d3.select('cont').style('width');\n\nconst df = data;\n\n\n// set the dimensions and margins of the graph\nvar margin = {top: 10, right: 30, bottom: 100, left: 100},\n    width2 = 460 - margin.left - margin.right,\n    height2 = 320 - margin.top - margin.bottom;\n\n// Margins etc\n\n//var svg = d3.select(\"#my_dataviz\")\nvar svg = cont\n  .append(\"svg\")\n  .attr(\"width\", width + margin.left + margin.right)\n  .attr(\"height\", height2 + margin.top + margin.bottom)\n//  .attr(\"viewBox\", [0, 0, 100,100])\n   //.attr( 'preserveAspectRatio',\"xMinYMin meet\")\n   .append(\"g\")\n    .attr(\"transform\",\n          \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\n\n// Parse the Data\n//d3.csv(\"https://raw.githubusercontent.com/holtzy/data_to_viz/master/Example_dataset/7_OneCatOneNum_header.csv\", function(data) {\n\n// sort data\n//data.sort(function(b, a) {\n//  return a.Value - b.Value;\n//});\n\n//https://www.d3-graph-gallery.com/graph/basic_datamanipulation.html\n//const borne = d3.max(df.map(function(d) { return d.borne_max; })); works\n//const borne = df.map(function(d) { return (d.borne_max)[0]; }); do not work\n\nconst largeur_graphe = d3.min([width-margin.left - margin.right,width2]);\n\n  \n// Add X axis //enter().append(\"cont\")\nvar x = d3.scaleLinear()\n  .domain([0, options.borne_max])\n .range([ 0, largeur_graphe]);\n \n  \nsvg.append(\"g\")\n  .attr(\"transform\", \"translate(0,\" + height2 + \")\")\n  .call(d3.axisBottom(x))\n  .selectAll(\"text\")\n    .attr(\"transform\", \"translate(-10,0)rotate(-45)\")\n    .style(\"text-anchor\", \"end\");\n  \n\n// Y axis\nvar y = d3.scaleBand()\n  .range([ 0, height2 ])\n  .domain(df.map(function(d) { return d.Country; }))\n  //.domain([\"A\",\"B\",\"C\",\"D\",\"E\"])\n  .padding(1);\n\n\n  \n  //.attr('strock-width',0)\nsvg.append(\"g\")\n  //.call(d3.axisLeft(y))\n\n\n\n// X axis title\nsvg.selectAll(\"xtitle\")\n  .data(df)\n  .enter()\n  .append(\"text\")\n    //.text(function(d) { return d.titre; })\n    .text(options.titre)\n    .attr(\"text-anchor\", \"end\")\n    .attr(\"x\", largeur_graphe)\n    .attr(\"y\", height2 + margin.top + 45)\n    .attr(\"font-family\" , \"sans-serif\")\n    .attr(\"font-size\" , \"12px\")\n    \n// X axis notes\nsvg.selectAll(\"xtitle\")\n  .data(df)\n  .enter()\n  .append(\"text\")\n    .text(options.note1)\n    .attr(\"x\", 0)\n    .attr(\"y\", height2 + margin.top + 65)\n    .attr(\"font-family\" , \"sans-serif\")\n    .attr(\"font-style\" , \"italic\")\n    .attr(\"font-size\" , \"11px\")\n    \nsvg.selectAll(\"xtitle\")\n  .data(df)\n  .enter()\n  .append(\"text\")\n    .text(options.note2)\n    .attr(\"x\", 0)\n    .attr(\"y\", height2 + margin.top + 80)\n    .attr(\"font-family\" , \"sans-serif\")\n    .attr(\"font-style\" , \"italic\")\n    .attr(\"font-size\" , \"11px\")\n \n\n\n\n    \n  \n\nfunction transition() { \n\n   var timeLine = svg.selectAll(\"myline\")\n   .data(df)\n    .enter()\n  .append(\"line\")\n  .attr(\"stroke-width\", 8)\n    .attr(\"x1\", x(0))\n    .attr(\"x2\", x(0))\n    .attr(\"y1\", function(d) { return y(d.Country); })\n    .attr(\"y2\", function(d) { return y(d.Country); })\n    .attr(\"stroke\", function(d) { return d.color; })\n \n  var timeCircle = svg.selectAll(\"mycircle\")\n    .data(df)\n    .enter()\n    .append(\"circle\")\n      .attr(\"cx\", x(0) )\n      .attr(\"cy\", function(d) { return y(d.Country); })\n      .attr(\"r\", \"15\")\n      .style(\"fill\", function(d) { return d.color; })\n   \n\n    \n    // InnerCircles -> start at X=0\n   var timeInnerCircle = svg.selectAll(\"myinnercircle\")\n    .data(df)\n    .enter()\n    .append(\"circle\")\n    .attr(\"cx\", x(0) )\n    .attr(\"cy\", function(d) { return y(d.Country); })\n    .attr(\"r\", \"10\")\n    .style(\"fill\", \"white\")\n   \n\n\n      var timeLabel = svg.selectAll(\"mylabel\")\n      .data(df)\n      .enter()\n      .append(\"text\")\n      .text(function(d){return d.Country;})\n      .attr(\"x\", x(0) )\n      .attr(\"y\", function(d) { return y(d.Country)+5; })\n    //.attr(\"font-family\" , \"Saira\")\n    .attr(\"font-size\" , \"14px\")\n    .attr(\"font-weight\" , 1000)\n    .attr(\"fill\" , function(d){return d.color})\n    .attr(\"text-anchor\", \"middle\")\n      \n  \n    repeat();\n    \n    function repeat() {\n      \n// Change the X coordinates of line and circle\n      timeLine\n      .transition()\n      .duration(1000)\n      .attr(\"x1\", function(d) { return x(d.Value); })\n      .transition()\n      .duration(5000)\n      .transition()\n      .duration(0)\n      .attr(\"x1\", function(d) { return x(0); })\n       .on(\"end\", repeat);  // when the transition finishes start again\n      \n      \n      // Change the X coordinates of line and circle\n      timeCircle\n //     .on(\"mouseover\", function() { mouseover2(); mouseover(); })\n //    .on(\"mousemove2\", function() { mousemove2(); mousemove(); })\n // .on(\"mouseleave\", function() { mouseleave2(); mouseleave(); })\n        .on(\"mouseover\", mouseover)\n    .on(\"mousemove\", mousemove)\n     .on(\"mouseleave\", mouseleave)\n    .transition()\n      .duration(1000)\n      .attr(\"cx\", function(d) { return x(d.Value); })\n      .transition()\n      .duration(5000)\n      .transition()\n      .duration(0)\n      .attr(\"cx\", function(d) { return x(0); })\n      .on(\"end\", repeat);  // when the transition finishes start again\n\n      timeInnerCircle\n       .on(\"mouseover\", mouseover)\n    .on(\"mousemove\", mousemove)\n     .on(\"mouseleave\", mouseleave)\n      .transition()\n      .duration(1000)\n      .attr(\"cx\", function(d) { return x(d.Value); })\n      .transition()\n      .duration(5000)\n      .transition()\n      .duration(0)\n      .attr(\"cx\", function(d) { return x(0); })\n      .on(\"end\", repeat);  // when the transition finishes start again\n\n\n      timeLabel\n      .transition()\n    .duration(1000)\n    .attr(\"x\", function(d) { return x(d.Value)-1; })\n    .transition()\n      .duration(5000)\n      .transition()\n      .duration(0)\n      .attr(\"x\", function(d) { return x(0); })\n\n\n\n    };\n\n};\n\ntransition();\n\n//https://datatricks.co.uk/animated-d3-js-bar-chart-in-r\n//https://www.d3-graph-gallery.com/graph/histogram_tooltip.html\n// tooltips\n\n//Create a tooltip\nvar Tooltip = d3.select('#htmlwidget_container')\n    .append('div')\n    .attr(\"class\", \"tooltip\")\n    .style('position', 'absolute')\n    .style('color', 'white')\n    .style('background-color', 'black')\n    .style('border-radius', '5px')\n    .style('padding', '5px')\n    .style('opacity', 0)\n    //.style(\"font-family\", \"Tahoma, Geneva, sans-serif\")\n    .style(\"font-size\", \"10pt\");\n \n//Mouseover effects for tooltip\nvar mouseover = function(event,d) {\n    Tooltip\n        .html('<b>' + d.Value + '<\/b> produits (<b>' + d.pourc + '<\/b> %)')\n        .style('opacity', 1)\n        .style('box-shadow', '5px 5px 5px rgba(0,0,0,0.2)')\n        .style(\"left\", (d3.pointer(event)[0]+120) + \"px\")\n        .style(\"top\", (d3.pointer(event)[1]+0) + \"px\");\n\n};\n\n// vieille version de d3\n//var mousemove = function(d) {\n//    Tooltip\n//        .html('Hello')\n//        .style(\"left\", (d3.mouse(this)[0]+0) + \"px\")\n//        .style(\"top\", (d3.mouse(this)[1]+0) + \"px\")\n//    };\n    \nvar mousemove = function(event,d) {\n\n  \n};\n\nvar mouseleave = function(d) {\n    Tooltip\n        .style(\"opacity\", 0);\n};\n\n//Mouseover effects for tooltip\nvar mouseover2 = function(d) {\n  \n      Tooltip\n        .style('opacity', 1)\n        .style('box-shadow', '5px 5px 5px rgba(0,0,0,0.2)');\n\n    d3.select(this)\n  .style('transition', '0.4s all cubic-bezier(0.5,0.8,0,1.7)')\n  .attr(\"r\", function (d) { return 15; });\n};\n\nvar mousemove2 = function(event) {\n  \n      Tooltip\n        .html('Hello')\n        .style(\"left\", (d3.pointer(event)[0]+120) + \"px\")\n        .style(\"top\", (d3.pointer(event)[1]+0) + \"px\");\n\n    d3.select(this)\n  .style('transition', '0.4s all cubic-bezier(0.5,0.8,0,1.7)')\n  .attr(\"r\", function (d) { return 18; });\n};\n\nvar mouseleave2 = function(d) {\n  \n   Tooltip\n        .style(\"opacity\", 0);\n        \n  d3.select(this)\n .style('transition', '0.4s all cubic-bezier(0.5,0.8,0,1.7)')\n .attr(\"r\", function (d) { return 15; });\n};\n\n\n\n\n//svg.selectAll('circle')\n//    .on(\"mouseover\", mouseover)\n//    .on(\"mousemove\", mousemove)\n//    .on(\"mouseleave\", mouseleave);\n};","style":null,"version":6,"theme":{"default":{"background":"#FFFFFF","foreground":"#000000"},"runtime":null},"useShadow":true},"evals":[],"jsHooks":[]}</script>
<script type="application/htmlwidget-sizing" data-for="htmlwidget-8cb82c2c3145491238d2">{"viewer":{"width":"100%","height":340,"padding":0,"fill":false},"browser":{"width":"100%","height":340,"padding":0,"fill":false}}</script>
</body>
</html>
